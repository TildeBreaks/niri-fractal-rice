# Niri Fractal Rice - Project Structure

## Overview
A cohesive Wayland desktop environment built around Niri WM (with Hyprland support) featuring dynamic fractal-based theming via Pywal integration.

## Directory Structure

```
~/.config/
├── niri/
│   └── config.kdl              # Niri window manager config
├── hypr/
│   └── hyprland.conf           # Hyprland window manager config
├── quickshell/
│   ├── topbar/
│   │   └── shell.qml           # Main topbar with system info, clock, workspaces
│   ├── sidebar/
│   │   └── shell.qml           # Side panel with GPU, FPS, perf modes, TFX, WAL
│   ├── wallpaper-picker.qml    # Wallpaper selection + flame generation
│   ├── app-launcher/           # Application launcher
│   └── bottombar/              # Terminal effects widget
├── kitty/
│   ├── kitty.conf              # Main kitty config
│   ├── local.conf              # Local overrides (font size, CRT shader)
│   ├── shaders/crt.glsl        # CRT scanline shader
│   └── fractals/               # Generated startup fractals
├── fastfetch/
│   ├── config.jsonc            # Fastfetch display config
│   └── logo.png                # Dynamic pywal-colored plasma logo
├── mako/
│   └── config                  # Notification daemon config (generated by pywal)
├── swaync/                     # SwayNC alternative (if installed)
│   ├── config.json
│   └── style.css
├── fish/
│   ├── config.fish             # Fish shell config
│   └── functions/
│       └── fish_greeting.fish  # Runs fastfetch on terminal open
├── wal/
│   └── templates/              # Pywal color templates
│       ├── mako-config
│       ├── colors-swaync.css
│       └── ... (other theme templates)
└── waybar/                     # Fallback bar config

~/.local/bin/
├── hyprland-pywal-colors.sh    # Update Hyprland colors from pywal
├── generate-flame.sh           # Generate fractal flame wallpapers
├── flam3-palette-util.sh       # Palette management for flame generation
├── generate-fractal.py         # Mandelbrot/Julia set generator
├── generate-terminal-logo.sh   # Generate pywal-colored logo for fastfetch
├── apply-wallpaper.sh          # Apply wallpaper with full theme update
├── generate-qt-theme.sh        # Qt/GTK theme generator
├── update-floorp-theme.sh      # Browser theme updater
└── caffeine-toggle.sh          # Screen sleep toggle

~/Pictures/wallpapers/          # Generated flame wallpapers
~/niri-fractal-rice/
├── scripts/                    # Original script sources
└── PROJECT_STRUCTURE.md        # This file
```

## Key Components

### Topbar (quickshell/topbar/shell.qml)
- **Left**: Sidebar toggle (☰), clock with calendar popup, workspace indicators
- **Center**: Window title
- **Right**: Tray, audio (with device switcher), network (with IP popup, click for nm), CPU (with process popup), RAM, TEMP, battery, caffeine
- **Hover behaviors**:
  - Clock: Shows calendar popup
  - CPU: Shows top processes by CPU usage
  - Network: Shows IP, interface, gateway
  - Audio: Click to switch devices

### Sidebar (quickshell/sidebar/shell.qml)
- **Toggle**: Via topbar button or keybind (creates ~/.cache/sidebar-toggle)
- **Buttons**: GPU stats, FPS overlay, Performance mode (ECO/BAL/MAX), REC
- **TFX**: Terminal FX launcher (cava, cmatrix, pipes, etc.)
- **WAL**: Wallpaper picker with RND generation and palette selection

### Flame Generation Pipeline
1. `generate-flame.sh [palette_name]` - Generate fractal flame
2. Optionally specify palette from `/usr/share/flam3/flam3-palettes.xml`
3. Apply via pywal → updates all theme components
4. Signal file `~/.cache/wallpaper-changed` notifies bars

### Pywal Integration
All components read colors from `~/.cache/wal/colors.json`:
- Topbar/Sidebar: Poll every 3 seconds
- Mako: Template at `~/.config/wal/templates/mako-config`
- SwayNC: Template at `~/.config/wal/templates/colors-swaync.css`
- Kitty: Includes `~/.cache/wal/colors-kitty.conf`

### IPC Signals
- `~/.cache/sidebar-toggle` - Toggle sidebar visibility
- `~/.cache/wallpaper-changed` - Wallpaper changed notification

## Display Setup
- Primary: DP-1 at 3440x1440@180Hz (ultrawide)
- Secondary: DP-2 at 1920x1080@200Hz

## Notification Daemon Options
- **Mako** (current): Lightweight, simple config
- **SwayNC** (alternative): Notification center, MPRIS, DND mode
  - Config ready at `~/.config/swaync/`
  - Install: `sudo pacman -S swaync`
  - Start: `swaync &`

## Quick Commands
```bash
# Generate random flame wallpaper
~/.local/bin/generate-flame.sh

# Generate flame with specific palette
~/.local/bin/generate-flame.sh Sunset

# List available palettes
~/.local/bin/flam3-palette-util.sh list

# Regenerate terminal logo
~/.local/bin/generate-terminal-logo.sh

# Restart UI components
systemctl --user restart quickshell-topbar.service
systemctl --user restart quickshell-sidebar.service
```
